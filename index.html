<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>노라벨 카카오 지도 (정렬/방향 수정)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { height:100%; margin:0; }
    #map { width:100%; height:100%; }
  </style>
  <script defer src="https://dapi.kakao.com/v2/maps/sdk.js?autoload=false&appkey=61f9ce735615595c9c947ffed8e89360"></script>
</head>
<body>
  <div id="map"></div>
  <script>
    // 음수/초과 인덱스를 0..n-1 범위로 래핑
    function wrapIndex(v, n){ return ((v % n) + n) % n; }

    // ★ 카카오 level(L) → 표준 타일 Z 변환
    // 보통 14 - L 가 가장 잘 맞습니다. (환경에 따라 15 - L 로 한 단계 보정 필요할 수 있음)
    function levelToTileZ(L){ return 14 - L; }

    window.addEventListener('DOMContentLoaded', function () {
      kakao.maps.load(function () {
        var subs = ['a','b','c','d']; // Carto 서브도메인

        kakao.maps.Tileset.add('NOLABEL',
          new kakao.maps.Tileset(
            256, 256,
            function(x, y, L){                // L = kakao level
              var Z  = levelToTileZ(L);       // ← 표준 타일 Z로 변환 (핵심)
              var n  = 1 << Z;                // 2^Z
              var yX = (n - 1) - y;           // TMS → XYZ (세로 뒤집기)
              var xX = wrapIndex(x, n);       // 인덱스 정규화
              yX     = wrapIndex(yX, n);

              var s  = subs[(x + y + L) & 3]; // a/b/c/d 순환
              return 'https://' + s + '.basemaps.cartocdn.com/rastertiles/light_nolabels/'
                     + Z + '/' + xX + '/' + yX + '.png';
            },
            [{ label: '© OpenStreetMap contributors · CARTO', minZoom: 0, maxZoom: 20 }],
            false, 0, 20
          )
        );

        var map = new kakao.maps.Map(document.getElementById('map'), {
          center: new kakao.maps.LatLng(37.5665, 126.9780),
          level: 6,                            // 시작 레벨
          mapTypeId: kakao.maps.MapTypeId.NOLABEL
        });
      });
    });
  </script>
</body>
</html>
