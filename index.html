<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>노라벨 카카오 지도 (400 해결판)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { height:100%; margin:0; }
    #map { width:100%; height:100%; }
  </style>
  <!-- HTTPS + autoload=false + defer -->
  <script defer src="https://dapi.kakao.com/v2/maps/sdk.js?autoload=false&appkey=61f9ce735615595c9c947ffed8e89360"></script>
</head>
<body>
  <div id="map"></div>
  <script>
    // 서브도메인 순환용 헬퍼: a,b,c,d
    function cartoHost(i){
      return ['a','b','c','d'][((i%4)+4)%4] + '.basemaps.cartocdn.com';
    }

    window.addEventListener('DOMContentLoaded', function () {
      kakao.maps.load(function () {

        // 1) 먼저 표준 OSM(라벨 有)로 테스트해보려면 아래 주석 해제
        // var TILE_URL = "https://tile.openstreetmap.org/{z}/{x}/{y}.png";

        // 1') 실제 목적: Carto 최신 노라벨(밝은 톤) - cartocdn.com 사용
        // 예: https://a.basemaps.cartocdn.com/light_nolabels/12/3456/1587.png
        // Retina 옵션 {r} 가 있는 스타일도 있으나 여기선 일반 PNG 사용
        var TILE_URL_TEMPLATE = "https://{s}/light_nolabels/{z}/{x}/{y}.png";

        // 2) Kakao Tileset 등록 (XYZ → TMS y반전 필수)
        kakao.maps.Tileset.add("NOLABEL",
          new kakao.maps.Tileset(
            256, 256,
            function(x, y, z){
              var yXYZ = Math.pow(2, z) - y - 1; // Kakao(TMS) → XYZ 변환
              // 서브도메인 a/b/c/d 순환
              var host = cartoHost(x + y + z);
              return TILE_URL_TEMPLATE
                .replace("{s}", host)
                .replace("{z}", z)
                .replace("{x}", x)
                .replace("{y}", yXYZ);
            },
            [{ label: "© OpenStreetMap contributors · CARTO", minZoom: 0, maxZoom: 22 }],
            false, 0, 22
          )
        );

        // 3) 지도 생성 시, 베이스맵을 우리가 등록한 NOLABEL로 **명시**
        var map = new kakao.maps.Map(document.getElementById("map"), {
          center: new kakao.maps.LatLng(37.5665, 126.9780),
          level: 6,
          mapTypeId: kakao.maps.MapTypeId.NOLABEL
        });

        // (중요) 혹시 기본 타입으로 돌아가지 않도록 타입 컨트롤 끄기(선택)
        // map.addControl(new kakao.maps.MapTypeControl(), kakao.maps.ControlPosition.TOPRIGHT);
        // ↑ 타입 컨트롤을 추가하면 ROADMAP 등으로 전환하며 카카오 타일을 칠 수 있으니,
        //   테스트 중엔 추가하지 않는 걸 권장
      });
    });
  </script>
</body>
</html>
